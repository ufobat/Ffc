<!DOCTYPE html>
<html>
  <head>
    <title>Chat</title>
    <link rel="icon" type="image/ico" href="<%= url_for 'favicon_show' %>" />
    <%= stylesheet '/theme/colors.css' %>
    <%= stylesheet '/theme/small.css', media => 'all and (max-device-width: 800px)' %>
    <%= stylesheet '/theme/large.css', media => 'all and (min-device-width: 801px)' %>
    <%= stylesheet '/theme/chat.css' %>
%= include 'layouts/parts/styleinc';
    <script type="text/javascript">
      ffcdata = { 
          user:           "<%= session()->{user}   || '' %>" || undefined,
          userid:         "<%= session()->{userid} || '' %>" || undefined,
          textpreviewurl: "<%= url_for 'textpreview' %>",
          notifications:  <%= session()->{notifications} ? 'true' : 'false' %>,
          chat: {
              title:           [' (', '/', ') Chat - ', <%== $title_array %>],
              userre:          /(\s|^|\.|!|,|\(|@)(<%= session->{user} %>)(\s|$|\.|!|\?|,|\)|:|;)/i,
              leaveurl:        '<%= url_for "chat_leave" %>',
              refreshseturl:   '<%= url_for "chat_set_refresh", refresh => 33 %>',
              focusedurl:      '<%= url_for "chat_receive_focused" %>',
              unfocusedurl:    '<%= url_for "chat_receive_unfocused" %>',
              startedurl:      '<%= url_for "chat_receive_started" %>',
              refresh:         60,
              to:              '',
              history_list:    <%== $history_list %>,
              history_pointer: <%= $history_pointer %>,
              newchatcountsum: 0,
              lastmsgtime:     '',
              lastmsguser:     '',
          },
      };
    </script>
    <%= javascript '/js/utils.js' %>
    <%= javascript '/js/editbuttons.js' %>
    <%= javascript '/js/chat.js' %>
  </head>
  <body>
   <!-- Angemeldet als "<%= session()->{user} %>" !-->

%= content

  <script type="text/javascript">
    ffcdata.utils.init();
    ffcdata.editbuttons.init();
    ffcdata.chat.init();
  </script>
  </body>
</html>
